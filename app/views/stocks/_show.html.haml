- cur_items = {"Mkt Cap"=>cur_data["mkt cap"], "Shares Out"=>cur_data["shares out"],
                "Float"=>cur_data["float"],"Shares Short"=>cur_data["short shares"]}
- stock_panel_id = "##{url ||= ""}"
- opinion = stock.opinions.length > 0 ? stock.opinions.first : nil
- if !stock
  #{symbol} not found
- else
  - symbol = stock.symbol
  .data_panel
    = link_to "Hide", stock_panel_id,:class=>["view_stock","hidePanel"], :symbol=>symbol
    %span.low_dates
      &nbsp;&nbsp;Lows:&nbsp;
      - stock.new_lows.each do |low|
        /#{Time.now.year} #{low.date.year} #{Time.now.year==low.date.year}
        = low.date.year == Time.now.year ? low.date.strftime("%m-%d") : low.date.strftime("%Y-%m-%d")
        &nbsp;
    .stock_head
      %span.symbol=link_to symbol, "http://quotes.wsj.com/#{symbol}",  :target=>"_blank"
      %span.co_info (#{stock.exch})
      %span.price #{cur_data["price"]}
      %span.update #{link_to "Update Data", stock_panel_id, :class=>"update_stock", :symbol=>symbol}
      %span.update |&nbsp; #{link_to "Rescrape", stock_panel_id,:class=>"update_stock", :symbol=>symbol, :force=>true}
      |&nbsp; #{link_to "YFinance", "http://finance.yahoo.com/q?s=#{symbol}",  :target=>"_blank"}
      |&nbsp; #{link_to "Edgar", "http://www.sec.gov/cgi-bin/browse-edgar?company=&match=&CIK=#{symbol}&filenum=&State=&Country=&SIC=&owner=exclude&Find=Find+Companies&action=getcompany",  :target=>"_blank"}


    .company_desc
      %span.sector=stock.sector
      %span.industry (#{stock.industry})
      %br
      =link_to "+", stock_panel_id, class: "exp_stock_desc", symbol: stock.symbol
      =link_to "-", stock_panel_id, class: "collapse_stock_desc", symbol: stock.symbol
      %span.desc{:desc=>stock.description}=stock.description[0..90] if stock.description
    .stock_section
      - cur_items.each_pair do |lbl, val|
        %span.cur_item_lbl #{lbl}:
        %span.cur_item #{val}&nbsp;&nbsp;
    - pl_attrs = [:sales, :net_inc, :ebda]
    - cf_attrs = [:capex,:net_asset_inv, :divs_paid]
    - bs_attrs = [:tot_assets, :tot_cur_assets, :tot_liab, :net_eq]
    .stock_section
      Fiscal Year: #{stock.fiscal_year}
      - inc="Inc"
      - bs="Bal Sh"
      - cf="Cash Fl"
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{inc}-A", :stmts=>stock.pl_annual,
              :attrs=>pl_attrs}
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{cf}-A", :stmts=>stock.cf_annual,
              :attrs=>cf_attrs}
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{bs}-A", :stmts=>stock.bs_annual,
              :attrs=>bs_attrs}
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{inc}-Q", :stmts=>stock.pl_qtr,
              :attrs=>pl_attrs}
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{cf}-Q", :stmts=>stock.cf_qtr,
              :attrs=>cf_attrs}
      = render :partial=>"stocks/fin_stmt", :locals=>{:title=>"#{bs}-Q", :stmts=>stock.bs_qtr,
              :attrs=>bs_attrs}

  .opinion_panel{:id=>stock.id}
    - if opinion
      = render :partial=>"opinions/show", :locals=>{:stock=>stock, :opinion=>opinion}
    - else
      = render :partial=>"opinions/form", :locals=>{:stock=>stock}

/= js "initStockPanel"